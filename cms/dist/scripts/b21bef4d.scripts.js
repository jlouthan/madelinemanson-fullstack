"use strict";function generateUniqueId(){var a=(new Date).getTime(),b="xxxxxxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:7&c|8).toString(16)});return b}function convertToSlug(a){return a.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")}var app=angular.module("cmsFrontendApp",["ngCookies","ngResource","ngSanitize","ngRoute","monospaced.elastic","ui.sortable","bDatepicker","ui.scrollfix","ui.keypress","ngAnimate","ui.bootstrap.modal","ui.bootstrap.transition","rzModule","infinite-scroll","ngQuickDate"]);app.config(["$routeProvider",function(a){a.when("/",{redirectTo:"/prints"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/prints",{templateUrl:"views/printManager.html",controller:"PrintManagerCtrl"}).when("/print/new",{templateUrl:"views/print.html",controller:"PrintCtrl"}).when("/print/:printId",{templateUrl:"views/print.html",controller:"PrintCtrl"}).when("/quilts",{templateUrl:"views/quiltManager.html",controller:"QuiltManagerCtrl"}).when("/quilt/new",{templateUrl:"views/quilt.html",controller:"QuiltCtrl"}).when("/quilt/:quiltId",{templateUrl:"views/quilt.html",controller:"QuiltCtrl"}).when("/objects",{templateUrl:"views/objectManager.html",controller:"ObjectManagerCtrl"}).when("/object/new",{templateUrl:"views/object.html",controller:"ObjectCtrl"}).when("/object/:objectId",{templateUrl:"views/object.html",controller:"ObjectCtrl"}).when("/books",{templateUrl:"views/bookManager.html",controller:"BookManagerCtrl"}).when("/book/new",{templateUrl:"views/book.html",controller:"BookCtrl"}).when("/book/:bookId",{templateUrl:"views/book.html",controller:"BookCtrl"}).when("/friends",{templateUrl:"views/friendManager.html",controller:"FriendManagerCtrl"}).when("/friend/new",{templateUrl:"views/friend.html",controller:"FriendCtrl"}).when("/friend/:friendId",{templateUrl:"views/friend.html",controller:"FriendCtrl"}).when("/cv",{templateUrl:"views/cv.html",controller:"CvCtrl"}).when("/etc",{templateUrl:"views/etc.html",controller:"EtcCtrl"}).otherwise({redirectTo:"/"})}]),app.config(["$locationProvider",function(a){a.html5Mode(!1),a.hashPrefix("!")}]);var setPristine=function(a){a.$setPristine?a.$setPristine():_.each(a,function(a){a.$dirty&&(a.$dirty=!1),a.$setDirty&&a.$setDirty(!1)})};angular.module("cmsFrontendApp").controller("LoginCtrl",["$scope","$rootScope","$location","$modal","$anchorScroll","loggedInChecker",function(a,b,c,d,e,f){function g(){f.validateUser()}b.userLoaded=!1,e(),console.log("in the login controller"),b.currentPage="login",g(),a.showLogin=function(b){a.loginVisible=b,b&&(a.username="",a.password="")},a.login=function(){return a.username&&a.password?void dpd.users.login({username:a.username,password:a.password},function(b,c){c?a.launchErrorModal():(location.href="#!/dashboard",g())}):void a.launchErrorModal()},a.launchErrorModal=function(){var b=d.open({templateUrl:"views/loginErrorModalTemplate.html"});b.result.then(function(){a.username="",a.password=""},function(){$log.info("Modal dismissed at: "+new Date)})},a.logout=function(){dpd.users.logout(function(){b.currentUser=null,a.$apply(),location.href="#!/login"})}}]);var ModalInstanceCtrl=["$scope","$http","$modalInstance","modalObj",function(a,b,c,d){a.modalObj=d,a.imageObj={},a.imageObj.altText=a.modalObj.altText||"",a.submitClass="inactive",a.uploadFile=function(c){a.uploading=!0,a.$apply(),console.log("the upload url is "+a.modalObj.uploadUrl);var d=new FormData;d.append("file",c);var e="http://aws-upload.madelinemanson.com/aws-upload"+a.modalObj.uploadUrl;b.post(e,d,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(b){a.submitClass="",a.submitEnabled=!0,a.imageObj.urls=b,console.log("success"),console.log("response is "+JSON.stringify(b))})},a.dropzoneConfig={options:{url:"/",createImageThumbnails:!1},eventHandlers:{addedfile:function(b){a.uploadFile(b)},success:function(){},accept:function(a,b){b("NOT DONE!")}}},a.ok=function(){c.close(a.imageObj)},a.cancel=function(){c.dismiss("cancel")}}],RemoveModalInstanceCtrl=["$scope","$modalInstance","obj","type",function(a,b,c,d){a.objTitle=c.name,a.objType=d,a.obj=c,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}],EditModalInstanceCtrl=["$scope","$modalInstance",function(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}];angular.module("cmsFrontendApp").controller("ThingCtrl",["$scope","$location","$routeParams","$rootScope","$compile","$modal","$log","blockInfo","$anchorScroll","loggedInChecker",function(a,b,c,d,e,f,g,h,i,j){function k(){for(var b=Math.floor(a.validTags.length/3),c=a.validTags.length%3,d=3-c,e=0;d>e;)a.tagColumn[e]=a.validTags.splice(0,b),e++;for(;3>e;)a.tagColumn[e]=a.validTags.splice(0,b+1),e++}j.validateUser(),d.currentPage="thing",a.subHeaderText="thing",i(),a.selectedTag=void 0,a.validTags=["Research","Strategy","Concepting","Branding","Photography","Information Architecture","Experience Design","Interactive Design","Visual Design","Industrial Design","System Architecture","Front End Development","Back End Development","Mobile Web","iOS/Android Native","Hardware Prototyping","Testing + Stabilization","Maintenance"],a.validTagsCopy=a.validTags.slice(0),a.tagColumn=[],k(),a.thingId=null,a.availableBlocks=[{name:"Pull quote",type:"pullQuote",id:"02ff9b74e90da8a0"},{name:"Video embed",type:"video",id:"1d3c508b08eec8e3"},{name:"2/3 Image left",type:"23left",id:"40736eaa1fba4b0a"},{name:"Full-bleed image",type:"fullBleed",id:"61deff5184d5f80d"},{name:"Code snippet",type:"code",id:"67165ff57b55ebf8"},{name:"Fullsize image",type:"image",id:"b525748a7ed128e5"},{name:"Body copy",type:"body",id:"b9134abdabd97869"},{name:"2/3 Video right",type:"23rightVideo",id:"bab43ae2a9f0285c"},{name:"2/3 Image right",type:"23right",id:"d2be0582f227c897"},{name:"2/3 Video left",type:"23leftVideo",id:"db1384dd300379fc"}],a.selectVals=["Option1","Option2","Option3","Option4"],d.currentUser?(a.thing={selectVal:{id:d.currentUser.id,firstName:d.currentUser.firstName,lastName:d.currentUser.lastName},blocks:[],state:"temp"},a.thing.blocks=a.availableBlocks,a.thing.tags=[],c.thingId&&(a.thingId=c.thingId)):location.href="#!/thing",a.thingSelectVal={label:"Select Option 1"},$("select").selectBoxIt({autoWidth:!1,downArrowIcon:"icon-dropdown",defaultText:a.thingSelectVal.label,populate:a.selectVals});$("select").data("selectBox-selectBoxIt");$("select").bind({change:function(){a.changeSelectVal($(this).val())}}),a.changeSelectVal=function(b){a.thing.someValue=b},a.getValidTags=function(){a.typingTag=!0,""===a.potentialTag&&(a.typingTag=!1);for(var b=a.potentialTag.length,c=[],d=0;d<a.validTagsCopy.length;d++)a.potentialTag.toUpperCase()===a.validTagsCopy[d].slice(0,b).toUpperCase()&&c.push(a.validTagsCopy[d]);a.validTags=c,k()},a.setTag=function(b){if(console.log("called it"),"undefined"==typeof b){for(var c=0;3>c;c++)if(a.tagColumn[c].length>0){-1==a.thing.tags.indexOf(a.tagColumn[c][0])&&(a.thing.tags.push(a.tagColumn[c][0]),a.potentialTag="",a.getValidTags());break}}else-1==a.thing.tags.indexOf(b)&&a.thing.tags.push(b)},a.removeTag=function(b){console.log("selected tag is "+b);{var c=a.thing.tags.indexOf(b);a.thing.tags.length}a.thing.tags.splice(c,1)},a.addBlock=function(b){var c=JSON.parse(JSON.stringify(b));return c.id=c.id+"-"+generateUniqueId(),a.thing.hasOwnProperty("blocks")||(a.thing.blocks=[]),a.thing.blocks.push(c),a.toggleDropdown(),!1},a.removeBlock=function(b){var c=a.thing.blocks.indexOf(b);a.thing.blocks.splice(c,1)},a.getBlockNameFromType=function(a){return h.getNameFromBlockType(a)},a.getIconFromBlockType=function(a){return h.getIconFromBlockType(a)},a.toggleDropdown=function(){a.dropdownShowing=!a.dropdownShowing},a.scrollToBlock=function(a){var c=b.hash();b.hash("block"+a),i(),b.hash(c)},a.openImageModal=function(b){if(b.name)var c=!0,d=h.getUrlForBlockType(b.type);else var d=h.getUrlForBlockType(b);d+=a.thing.id;var e=f.open({templateUrl:"views/imageModalTemplate.html",controller:ModalInstanceCtrl,resolve:{fieldType:function(){return c?b.type:b},uploadUrl:function(){return d},currentPage:function(){return"blog"}}});e.result.then(function(d){"Blog Teaser Image"===b?a.thing.teaserImage=d.urls:"Hero Parallax Image"===b?a.thing.heroImage=d.urls:c&&(b.imageUrl=d.urls,b.alt=d.altText)},function(){g.info("Modal dismissed at: "+new Date)})},a.shouldDisplayThumb=function(b){return a.thing?"Blog Teaser Image"===b?a.thing.teaserImage&&a.thing.teaserImage.mdpi?!0:!1:"Hero Parallax Image"===b&&a.thing.heroImage&&a.thing.heroImage.mdpi?!0:!1:!1},a.imageThumbnail=function(b){if(a.shouldDisplayThumb(b)){if("Blog Teaser Image"===b)var c=a.thing.teaserImage;else if("Hero Parallax Image"===b)var c=a.thing.heroImage;return{backgroundImage:"url("+c.mdpi+")"}}return""},a.blockShouldDisplayThumb=function(a){return a.imageUrl&&a.imageUrl.mdpi?!0:!1},a.blockImageThumbnail=function(b){return a.blockShouldDisplayThumb(b)?{backgroundImage:"url("+b.imageUrl.mdpi+")"}:void 0},a.formIsValid=function(){return a.thing?!0:!1},a.save=function(){return this.thingForm.$invalid?(console.log("INVALID"),!1):(a.thing.lastSaved=(new Date).getTime(),"temp"==a.thing.state&&(a.thing.state="draft"),a.thing.datePublished||(a.thing.slug=convertToSlug(a.thing.title)),void(a.thingId&&a.remapSelectVal()))},a.publish=function(){return this.blogForm.$invalid?!1:(a.thing.datePublished||(a.thing.datePublished=(new Date).getTime()),a.thing.slug||(a.thing.slug=convertToSlug(a.thing.title)),a.thing.state="published",void(a.thingId&&a.remapSelectVal()))},a.unpublish=function(){a.thing.state="draft",a.save(),a.startAutoSave()},a.startAutoSave=function(){a.autoSaveTimer=setTimeout(function(){a.autoSave()},1e4)},a.autoSave=function(){b.$$path=="/blog/"+a.thingId&&(a.blogForm.$dirty&&a.formIsValid()&&a.save(),a.startAutoSave())},a.stopAutoSave=function(){clearTimeout(a.autoSaveTimer)},a.stopAutoSave(),a.back=function(){a.stopAutoSave(),b.path("/blog").replace()}}]),angular.module("cmsFrontendApp").controller("ThingManagerCtrl",["$scope","$location","$routeParams","$rootScope","$modal","loggedInChecker","listSorting","modalManager",function(a,b,c,d,e,f,g,h){f.validateUser(),d.currentPage="thing",a.go=function(a){location.href="#!/thing/"+a.id},a.sortBy=function(b){"title"===b&&(a.sortedByTitleAZ?(a.feed.things=g.sortBy("titleZA",a.feed.things),a.sortedByTitleZA=!0,a.sortedByTitleAZ=!1):(a.feed.things=g.sortBy("titleAZ",a.feed.things),a.sortedByTitleAZ=!0,a.sortedByTitleZA=!1))},a.remove=function(b){a.feed.things=_.without(a.feed.things,b)},a.openRemoveModal=function(b){h.removalModal(b,a.remove)};var i=15,j=function(a){this.query=a||{},this.things=[],this.moreToLoad=!0};j.prototype.loadContents=function(){var a=this;if(a.moreToLoad){this.moreToLoad=!1;var b=angular.copy(this.query);b.$limit=i,a.things&&(b.$skip=a.things.length),b.$sort={lastSaved:-1},b.state={$in:["draft","published"]},b.$fields={title:1,datePublished:1,author:1,state:1};var c=new Date,d=new Date("05/19/1956"),e=new Date("05/10/1960");a.things=[{title:"Thing 1",property1:"Green",property2:"Squiggly",state:"published",date:c,id:1},{title:"Thing 2",property1:"Yellow",property2:"Scratchy",state:"published",date:d,id:2},{title:"Thing 3",property1:"Orange",property2:"Bumpy",state:"published",date:e,id:3}]}};var k=new j;a.feed=k}]),angular.module("cmsFrontendApp").controller("PrintCtrl",["$scope","$rootScope","loggedInChecker","$anchorScroll","$routeParams","modalManager",function(a,b,c,d,e,f){function g(){var b={$sort:{weighting:1},id:{$ne:a.printId},state:"published"};dpd.prints.get(b,function(b){if(b&&b.length>0&&b[0].weighting){var c=b[0].weighting;a.print.weighting=c-1}else a.print.weighting=20;a.updatePrint()})}c.validateUser(),b.currentPage="prints",d(),a.printId=null,e.printId?(a.printId=e.printId,dpd.prints.get(a.printId,function(b,c){c?(console.log("there was an error: "),console.log(c)):(console.log(b),a.print=b,a.subHeaderText="temp"===b.state?"print-new":"print",a.$apply())})):(a.print={state:"temp",createdBy:b.currentUser.id},dpd.prints.post(a.print,function(a,b){b?(console.log("there was an error"),console.log(b)):location.href="#!/print/"+a.id})),a.back=function(){location.href="#!/prints"},a.formIsValid=function(){return a.print&&a.print.name&&a.print.image?!0:!1},a.updatePrint=function(){a.printId&&dpd.prints.put(a.print,function(b,c){c?(console.log("there was an error: "),console.log(c),a.serverError=c):location.href="#!/prints"})},a.save=function(){return a.formIsValid()?(a.print.state="published",a.print.slug=convertToSlug(a.print.name),void(a.print.weighting?a.updatePrint():g())):(a.invalidSubmitted=!0,!1)},a.openImageModal=function(){var b={};b.hasAltText=!0,b.altText=a.print.imageAltText,b.icon="icon-img",b.templateUrl="",b.spec="at least px x px",b.title="Print Image",b.info="Image of the print to appear as thumbnail and in carousel.",b.uploadUrl="/resize-portfolio-image/"+a.print.id+"/image",f.imageModal(b).then(function(b){a.print.image=b.urls,a.print.imageAltText=b.altText})},a.imageThumbnail=function(){if(a.print){var b=a.print.image;if(b)return{backgroundImage:"url("+b["carousel-xhdpi"]+")"}}return""}}]),angular.module("cmsFrontendApp").controller("PrintManagerCtrl",["$scope","$rootScope","$location","loggedInChecker","modalManager","weightUpdater",function(a,b,c,d,e,f){d.validateUser(),b.currentPage="prints";var g=10,h=function(a){this.query=a||{},this.prints=[],this.moreToLoad=!0};h.prototype.loadContents=function(){var b=this;if(b.moreToLoad){this.moreToLoad=!1;var c=angular.copy(this.query);c.$limit=g,b.prints&&(c.$skip=b.prints.length),c.$limit=g,c.$sort={weighting:-1},c.state="published",c.$fields={name:1,image:1,dateCreated:1,weighting:1},dpd.prints.get(c,function(c){b.moreToLoad=c.length>=g?!0:!1,Array.prototype.push.apply(b.prints,c),a.prints=b.prints,a.feed=b,a.$apply()})}};var i=new h;a.feed=i,a.sortingOptions=f.sortingOptions(a.feed.prints,"prints",a),a.openRemoveModal=function(b){e.removalModal(b,"print").then(function(){a.feed.prints=_.without(a.feed.prints,b),b.state="deleted",dpd.prints.put(b,function(a){a&&console.log(a)})})}}]),angular.module("cmsFrontendApp").controller("QuiltCtrl",["$scope","$rootScope","loggedInChecker","$anchorScroll","$routeParams","modalManager","$location",function(a,b,c,d,e,f,g){function h(){var b={$sort:{weighting:1},id:{$ne:a.quiltId},state:"published"};dpd.quilts.get(b,function(b){if(b&&b.length>0&&b[0].weighting){var c=b[0].weighting;a.quilt.weighting=c-1}else console.log("updating the weight"),a.quilt.weighting=20;a.updateQuilt()})}c.validateUser(),b.currentPage="quilts",d(),a.quiltId=null,a.availableBlocks=[{name:"Fullsize Image",type:"image",id:"02ff9b74e90da8a0"}],e.quiltId?(a.quiltId=e.quiltId,dpd.quilts.get(a.quiltId,function(b,c){c?(console.log("there was an error: "),console.log(c)):(console.log(b),a.quilt=b,a.subHeaderText="temp"===b.state?"quilt-new":"quilt",a.$apply())})):(a.quilt={state:"temp",createdBy:b.currentUser.id},dpd.quilts.post(a.quilt,function(a,b){b?(console.log("there was an error"),console.log(b)):location.href="#!/quilt/"+a.id})),a.back=function(){location.href="#!/quilts"},a.formIsValid=function(){return a.quilt&&a.quilt.name?(console.log("returning valid form"),!0):!1},a.updateQuilt=function(){a.quiltId&&(console.log(a.quilt),dpd.quilts.put(a.quilt,function(b,c){c?(console.log("there was an error: "),console.log(c),a.serverError=c):(console.log("updated the quilt!"),location.href="#!/quilts")}))},a.save=function(){return a.formIsValid()?(a.quilt.state="published",a.quilt.slug=convertToSlug(a.quilt.name),void(a.quilt.weighting?a.updateQuilt():h())):(a.invalidSubmitted=!0,!1)},a.openImageModal=function(b){var c={};c.hasAltText=!0,c.altText=b.imageAltText,c.icon="icon-img",c.templateUrl="",c.spec="at least px x px",c.title="Quilt Image",c.info="Image of the quilt to appear in vertical scroll view.",c.uploadUrl="/resize-portfolio-image/"+a.quilt.id+"/image",f.imageModal(c).then(function(a){b.image=a.urls,b.imageAltText=a.altText})},a.blockImageThumbnail=function(b){if(a.quilt){var c=b.image;if(c)return{backgroundImage:"url("+c["carousel-xhdpi"]+")"}}return""},a.scrollToBlock=function(a){var b=g.hash();g.hash("block"+a),d(),g.hash(b)},a.toggleDropdown=function(){a.dropdownShowing=!a.dropdownShowing},a.addBlock=function(){var b={};return b.id=generateUniqueId(),b.name="Fullsize Image",a.quilt.hasOwnProperty("images")||(a.quilt.images=[]),a.quilt.images.push(b),a.toggleDropdown(),!1},a.removeBlock=function(b){var c=a.quilt.images.indexOf(b);a.quilt.images.splice(c,1)}}]),angular.module("cmsFrontendApp").controller("QuiltManagerCtrl",["$scope","$rootScope","$location","loggedInChecker","modalManager","weightUpdater",function(a,b,c,d,e,f){d.validateUser(),b.currentPage="quilts";var g=10,h=function(a){this.query=a||{},this.quilts=[],this.moreToLoad=!0};h.prototype.loadContents=function(){var b=this;if(b.moreToLoad){this.moreToLoad=!1;var c=angular.copy(this.query);c.$limit=g,b.quilts&&(c.$skip=b.quilts.length),c.$limit=g,c.$sort={weighting:-1},c.state="published",c.$fields={name:1,thumbnail:1,dateCreated:1,weighting:1},dpd.quilts.get(c,function(c){b.moreToLoad=c.length>=g?!0:!1,Array.prototype.push.apply(b.quilts,c),a.quilts=b.quilts,a.feed=b,a.$apply()})}};var i=new h;a.feed=i,a.sortingOptions=f.sortingOptions(a.feed.quilts,"quilts",a),a.openRemoveModal=function(b){e.removalModal(b,"quilt").then(function(){a.feed.quilts=_.without(a.feed.quilts,b),b.state="deleted",dpd.quilts.put(b,function(a){a&&console.log(a)})})}}]),angular.module("cmsFrontendApp").controller("ObjectCtrl",["$scope","$rootScope","loggedInChecker","$anchorScroll","$routeParams","modalManager","$location",function(a,b,c,d,e,f,g){function h(){var b={$sort:{weighting:1},id:{$ne:a.objectId},state:"published"};dpd.objects.get(b,function(b){if(b&&b.length>0&&b[0].weighting){var c=b[0].weighting;a.object.weighting=c-1}else a.object.weighting=20;a.updateObject()})}c.validateUser(),b.currentPage="objects",d(),a.objectId=null,a.availableBlocks=[{name:"Fullsize Image",type:"image",id:"02ff9b74e90da8a0"}],e.objectId?(a.objectId=e.objectId,dpd.objects.get(a.objectId,function(b,c){c?(console.log("there was an error: "),console.log(c)):(console.log(b),a.object=b,a.subHeaderText="temp"===b.state?"object-new":"object",a.$apply())})):(a.object={state:"temp",createdBy:b.currentUser.id},dpd.objects.post(a.object,function(a,b){b?(console.log("there was an error"),console.log(b)):location.href="#!/object/"+a.id})),a.back=function(){location.href="#!/objects"},a.formIsValid=function(){return a.object&&a.object.name&&a.object.images?!0:!1},a.updateObject=function(){a.objectId&&dpd.objects.put(a.object,function(b,c){c?(console.log("there was an error: "),console.log(c),a.serverError=c):location.href="#!/objects"})},a.save=function(){return a.formIsValid()?(a.object.state="published",a.object.slug=convertToSlug(a.object.name),void(a.object.weighting?a.updateObject():h())):(a.invalidSubmitted=!0,!1)},a.openImageModal=function(b){var c={};c.hasAltText=!0,c.altText=b.imageAltText,c.icon="icon-img",c.templateUrl="",c.spec="at least px x px",c.title="Object Image",c.info="Image of the object to appear in thumbnail and carousel views.",c.uploadUrl="/resize-portfolio-image/"+a.object.id+"/image",f.imageModal(c).then(function(a){b.image=a.urls,b.imageAltText=a.altText})},a.blockImageThumbnail=function(b){if(a.object){var c=b.image;if(c)return{backgroundImage:"url("+c["carousel-xhdpi"]+")"}}return""},a.scrollToBlock=function(a){var b=g.hash();g.hash("block"+a),d(),g.hash(b)},a.toggleDropdown=function(){a.dropdownShowing=!a.dropdownShowing},a.addBlock=function(b){var c=JSON.parse(JSON.stringify(b));return c.id=c.id+"-"+generateUniqueId(),a.object.hasOwnProperty("images")||(a.object.images=[]),a.object.images.push(c),a.toggleDropdown(),!1},a.removeBlock=function(b){var c=a.object.images.indexOf(b);a.object.images.splice(c,1)}}]),angular.module("cmsFrontendApp").controller("ObjectManagerCtrl",["$scope","$rootScope","$location","loggedInChecker","modalManager","weightUpdater",function(a,b,c,d,e,f){d.validateUser(),b.currentPage="objects";var g=10,h=function(a){this.query=a||{},this.objects=[],this.moreToLoad=!0};h.prototype.loadContents=function(){var b=this;if(b.moreToLoad){this.moreToLoad=!1;var c=angular.copy(this.query);c.$limit=g,b.objects&&(c.$skip=b.objects.length),c.$limit=g,c.$sort={weighting:-1},c.state="published",c.$fields={name:1,thumbnail:1,dateCreated:1,weighting:1},dpd.objects.get(c,function(c){b.moreToLoad=c.length>=g?!0:!1,Array.prototype.push.apply(b.objects,c),a.objects=b.objects,a.feed=b,a.$apply()})}};var i=new h;a.feed=i,a.sortingOptions=f.sortingOptions(a.feed.objects,"objects",a),a.openRemoveModal=function(b){e.removalModal(b,"object").then(function(){a.feed.objects=_.without(a.feed.objects,b),b.state="deleted",dpd.objects.put(b,function(a){a&&console.log(a)})})}}]),angular.module("cmsFrontendApp").controller("BookCtrl",["$scope","$rootScope","loggedInChecker","$anchorScroll","$routeParams","modalManager","$location",function(a,b,c,d,e,f,g){function h(){var b={$sort:{weighting:1},id:{$ne:a.bookId},state:"published"};dpd.books.get(b,function(b){if(b&&b.length>0&&b[0].weighting){var c=b[0].weighting;a.book.weighting=c-1}else a.book.weighting=20;a.updateBook()})}c.validateUser(),b.currentPage="books",d(),a.bookId=null,a.availableBlocks=[{name:"Fullsize Image",type:"image",id:"02ff9b74e90da8a0"}],e.bookId?(a.bookId=e.bookId,dpd.books.get(a.bookId,function(b,c){c?(console.log("there was an error: "),console.log(c)):(console.log(b),a.book=b,a.subHeaderText="temp"===b.state?"book-new":"book",a.$apply())})):(a.book={state:"temp",createdBy:b.currentUser.id},dpd.books.post(a.book,function(a,b){b?(console.log("there was an error"),console.log(b)):location.href="#!/book/"+a.id})),a.back=function(){location.href="#!/books"},a.formIsValid=function(){return a.book&&a.book.name&&a.book.images?!0:!1},a.updateBook=function(){a.bookId&&dpd.books.put(a.book,function(b,c){c?(console.log("there was an error: "),console.log(c),a.serverError=c):location.href="#!/books"})},a.save=function(){return a.formIsValid()?(a.book.state="published",a.book.slug=convertToSlug(a.book.name),void(a.book.weighting?a.updateBook():h())):(a.invalidSubmitted=!0,!1)},a.openImageModal=function(b){var c={};c.hasAltText=!0,c.altText=b.imageAltText,c.icon="icon-img",c.templateUrl="",c.spec="at least px x px",c.title="Book Image",c.info="Image of the book to appear in thumbnail and carousel views.",c.uploadUrl="/resize-portfolio-image/"+a.book.id+"/image",f.imageModal(c).then(function(a){b.image=a.urls,b.imageAltText=a.altText})},a.blockImageThumbnail=function(b){if(a.book){var c=b.image;if(c)return{backgroundImage:"url("+c["carousel-xhdpi"]+")"}}return""},a.scrollToBlock=function(a){var b=g.hash();g.hash("block"+a),d(),g.hash(b)},a.toggleDropdown=function(){a.dropdownShowing=!a.dropdownShowing},a.addBlock=function(b){var c=JSON.parse(JSON.stringify(b));return c.id=c.id+"-"+generateUniqueId(),a.book.hasOwnProperty("images")||(a.book.images=[]),a.book.images.push(c),a.toggleDropdown(),!1},a.removeBlock=function(b){var c=a.book.images.indexOf(b);a.book.images.splice(c,1)}}]),angular.module("cmsFrontendApp").controller("BookManagerCtrl",["$scope","$rootScope","$location","loggedInChecker","modalManager","weightUpdater",function(a,b,c,d,e,f){d.validateUser(),b.currentPage="books";var g=10,h=function(a){this.query=a||{},this.books=[],this.moreToLoad=!0};h.prototype.loadContents=function(){var b=this;if(b.moreToLoad){this.moreToLoad=!1;var c=angular.copy(this.query);c.$limit=g,b.books&&(c.$skip=b.books.length),c.$limit=g,c.$sort={weighting:-1},c.state="published",c.$fields={name:1,thumbnail:1,dateCreated:1,weighting:1},dpd.books.get(c,function(c){b.moreToLoad=c.length>=g?!0:!1,Array.prototype.push.apply(b.books,c),a.books=b.books,a.feed=b,a.$apply()})}};var i=new h;a.feed=i,a.sortingOptions=f.sortingOptions(a.feed.books,"books",a),a.openRemoveModal=function(b){e.removalModal(b,"book").then(function(){a.feed.books=_.without(a.feed.books,b),b.state="deleted",dpd.books.put(b,function(a){a&&console.log(a)})})}}]),angular.module("cmsFrontendApp").controller("FriendCtrl",["$scope","$rootScope","loggedInChecker","$anchorScroll","$routeParams","modalManager","$location",function(a,b,c,d,e){function f(){var b={$sort:{weighting:1},id:{$ne:a.friendId},state:"published"};dpd.friends.get(b,function(b){if(b&&b.length>0&&b[0].weighting){var c=b[0].weighting;a.friend.weighting=c-1}else a.friend.weighting=20;a.updateFriend()})}c.validateUser(),b.currentPage="friends",d(),a.friendId=null,e.friendId?(a.friendId=e.friendId,dpd.friends.get(a.friendId,function(b,c){c?(console.log("there was an error: "),console.log(c)):(console.log(b),a.friend=b,a.subHeaderText="temp"===b.state?"friend-new":"friend",a.$apply())})):(a.friend={state:"temp",createdBy:b.currentUser.id},dpd.friends.post(a.friend,function(a,b){b?(console.log("there was an error"),console.log(b)):location.href="#!/friend/"+a.id})),a.back=function(){location.href="#!/friends"},a.formIsValid=function(){return a.friend&&a.friend.name&&a.friend.url?!0:!1},a.updateFriend=function(){a.friendId&&dpd.friends.put(a.friend,function(b,c){c?(console.log("there was an error: "),console.log(c),a.serverError=c):location.href="#!/friends"})},a.save=function(){return a.formIsValid()?(a.friend.state="published",a.friend.slug=convertToSlug(a.friend.name),void(a.friend.weighting?a.updateFriend():f())):(a.invalidSubmitted=!0,!1)}}]),angular.module("cmsFrontendApp").controller("FriendManagerCtrl",["$scope","$rootScope","$location","loggedInChecker","modalManager","weightUpdater",function(a,b,c,d,e,f){d.validateUser(),b.currentPage="friends";var g=15,h=function(a){this.query=a||{},this.friends=[],this.moreToLoad=!0};h.prototype.loadContents=function(){var b=this;if(b.moreToLoad){this.moreToLoad=!1;var c=angular.copy(this.query);c.$limit=g,b.friends&&(c.$skip=b.friends.length),c.$limit=g,c.$sort={weighting:-1},c.state="published",c.$fields={name:1,url:1,dateCreated:1,weighting:1},dpd.friends.get(c,function(c){b.moreToLoad=c.length>=g?!0:!1,Array.prototype.push.apply(b.friends,c),a.friends=b.friends,a.feed=b,a.$apply()})}};var i=new h;a.feed=i,a.sortingOptions=f.sortingOptions(a.feed.friends,"friends",a),a.openRemoveModal=function(b){e.removalModal(b,"friend").then(function(){a.feed.friends=_.without(a.feed.friends,b),b.state="deleted",dpd.friends.put(b,function(a){a&&console.log(a)})})}}]),angular.module("cmsFrontendApp").controller("CvCtrl",["$scope","$rootScope","loggedInChecker","modalManager",function(a,b,c){c.validateUser(),b.currentPage="cv",a.subHeaderText="cv",dpd.cv.get(function(b,c){c?(console.log("there was an error: "),console.log(c)):(a.cv=b[0],a.$apply(),a.cv.slug="cv")}),a.formIsValid=function(){return a.cv&&a.cv.content?!0:!1},a.save=function(){return a.validSubmitted=!1,a.formIsValid()?void dpd.cv.put(a.cv,function(b,c){c?(console.log("there was an error: "),console.log(c),a.serverError=c):(a.cv=b,a.cv.slug="cv",a.validSubmitted=!0,a.$apply())}):(a.invalidSubmitted=!0,!1)}}]),angular.module("cmsFrontendApp").controller("EtcCtrl",["$scope","$rootScope","loggedInChecker","modalManager",function(a,b,c,d){c.validateUser(),b.currentPage="etc",a.subHeaderText="etc",dpd.etc.get(function(b,c){c?(console.log("there was an error: "),console.log(c)):(a.etc=b[0],a.$apply(),a.etc.slug="etc")}),a.formIsValid=function(){return a.etc&&a.etc.homeImage&&a.etc.aboutImage&&a.etc.friendsImage?!0:!1},a.save=function(){return a.validSubmitted=!1,a.formIsValid()?void dpd.etc.put(a.etc,function(b,c){c?(console.log("there was an error: "),console.log(c),a.serverError=c):(a.etc=b,a.etc.slug="etc",a.validSubmitted=!0,a.$apply())}):(a.invalidSubmitted=!0,!1)},a.openImageModal=function(b){var c={};c.hasAltText=!0,c.altText=a.etc[b+"altText"],c.icon="icon-img",c.templateUrl="","homeImage"===b?(c.title="Home Page Image",c.info="Large image shown on the home page.",c.uploadUrl="/resize-home-image/"+a.etc.id,c.spec="at least 1152px x 550px"):"aboutImage"===b?(c.title="About Page Image",c.info="Image shown on the about page.",c.uploadUrl="/resize-about-image/"+a.etc.id,c.spec="at least 1152px x 550px"):(c.title="Friends Page Image",c.info="Image shown on the friends page.",c.uploadUrl="/resize-about-image/"+a.etc.id,c.spec="at least 1152px x 550px"),d.imageModal(c).then(function(c){a.etc[b]=c.urls,a.etc[b+"altText"]=c.altText})},a.imageThumbnail=function(b){if(a.etc){var c=a.etc[b];if(c)return{backgroundImage:"url("+c.xhdpi+")"}}return""}}]),angular.module("cmsFrontendApp").directive("subHeader",function(){return{restrict:"E",replace:!0,scope:{currentPage:"@",currentObject:"=currentObj",publish:"&publishFcn",unpublish:"&unpublishFcn",save:"&saveFcn",back:"&",isValid:"&formIsValid"},controller:["$scope",function(){}],templateUrl:"views/subHeaderTemplate.html"}}),angular.module("cmsFrontendApp").directive("subHeaderSimple",function(){return{restrict:"E",replace:!0,scope:{},controller:["$scope",function(){}],templateUrl:"views/subHeaderSimpleTemplate.html"}}),angular.module("cmsFrontendApp").directive("inputWithCharacterBackground",function(){return{restrict:"A",templateUrl:"/views/inputWithCharacterBackgroundTemplate.html",scope:{ngModel:"=",inputName:"@",icon:"@"},controller:["$scope","$element","$attrs",function(a){a.toggleFocus=function(){a.inputFocus=!a.inputFocus}}],link:function(a,b){a.$watch("inputFocus",function(a){var c="";c=a?"#f26a21":"#a6a6a6",b.css("border-color",c),b.children(".background-icon").css("color",c)})}}}),angular.module("cmsFrontendApp").directive("dropzone",function(){return{restrict:"EA",link:function(a,b){var c=a.dropzoneConfig,d=new Dropzone(b[0],c.options);_.each(c.eventHandlers,function(a,b){d.on(b,a)})}}}),angular.module("cmsFrontendApp").service("$fileUpload",["$http",function(){this.uploadFile=function(){}}]),angular.module("cmsFrontendApp").service("loggedInChecker",["$rootScope",function(a){a.userLoaded=!1,this.validateUser=function(){dpd.users.me(function(b){b?(a.currentUser=b,a.userLoaded=!0,a.$apply()):location.href="#!/login"})}}]),angular.module("cmsFrontendApp").service("listSorting",function(){this.sortAZ=function(a,b){return a.title.toUpperCase()<b.title.toUpperCase()?-1:a.title.toUpperCase()>b.title.toUpperCase()?1:0},this.sortZA=function(a,b){return a.title.toUpperCase()>b.title.toUpperCase()?-1:a.title.toUpperCase()<b.title.toUpperCase()?1:0},this.sortBy=function(a,b){return b.sort("titleZA"===a?this.sortZA:this.sortAZ),b}}),angular.module("cmsFrontendApp").service("modalManager",["$modal",function(a){this.imageModal=function(b){var c=a.open({templateUrl:"views/imageModalTemplate.html",controller:ModalInstanceCtrl,resolve:{modalObj:function(){return b}}}),d=c.result.then(function(a){return a});return d},this.removalModal=function(b,c){var d=a.open({templateUrl:"views/removeModalTemplate.html",controller:RemoveModalInstanceCtrl,resolve:{obj:function(){return b},type:function(){return c}}}),e=d.result.then(function(){});return e},this.editModal=function(){var b=a.open({templateUrl:"views/editModalTemplate.html",controller:EditModalInstanceCtrl}),c=b.result.then(function(){});return c},this.archiveBeerModal=function(b,c){var d=a.open({templateUrl:"views/archiveBeerModalTemplate.html",controller:ArchiveBeerModalInstanceCtrl,resolve:{beerObj:function(){return b},archiving:function(){return c}}}),e=d.result.then(function(a){return a});return e}}]),angular.module("cmsFrontendApp").directive("ucsSelectBox",["$timeout",function(a){return{restrict:"E",scope:{ngModel:"=",selectId:"@",defaultText:"@",selectOptions:"=",selectClass:"@"},template:'<select class="{{selectClass}}" id="{{selectId}}"></select>',link:function(b){var c="select#"+b.selectId;a(function(){$(c).selectBoxIt({autoWidth:!1,downArrowIcon:"icon-dropdown",defaultText:b.defaultText,populate:b.selectOptions}),$(c).bind({change:function(){b.ngModel=$(this).val(),b.$apply()
}})}),b.$watch("defaultText",function(a){var b=$(c).data("selectBox-selectBoxIt");b&&b.setOption("defaultText",a)})}}}]),angular.module("cmsFrontendApp").service("weightUpdater",function(){var a=20,b=this.updateWeights=function(b,c,d){for(var e=0;e<b.length;e++)b[e].status&&"brewing now"===b[e].status||(b[e].weighting=a-e,dpd[c].put(b[e],function(a,b){b&&console.log("an error occurred updating weights")}));d.$$phase||d.$apply()};this.sortingOptions=function(a,c,d,e){var f=e||"> *",g={scroll:!1,items:f,stop:function(){b(a,c,d)},helper:function(a,b){var c=b.children(),d=b.clone();return d.children().each(function(a){$(this).width(c.eq(a).width())}),d}};return g}}),angular.module("cmsFrontendApp").service("blockInfo",function(){this.getNameFromBlockType=function(a){var b="";switch(a){case"23right":b="Image Right";break;case"23left":b="Image Left";break;case"fullBleed":b="Image Break";break;case"pullQuote":b="Pull Quote";break;case"23rightVideo":b="Embed Video Right";break;case"23leftVideo":b="Embed Video Left";break;case"body":b="Body Copy";break;case"image":b="Full Size Image";break;case"code":b="Code Snippet";break;case"video":b="Embed Video";break;case"Teaser Image":b="Teaser Image";break;case"Lead Photo":b="Lead Photo";break;case"Blog Teaser Image":b="Blog Teaser";break;case"Hero Parallax Image":b="Hero Parallax";break;case"Avatar BW":b="Avatar (B&W)";break;case"Avatar Color":b="Avatar (Color)"}return b},this.getIconFromBlockType=function(a){var b="";switch(a){case"23right":b="icon-contentRight";break;case"23left":b="icon-contentLeft";break;case"fullBleed":b="icon-imgBreak";break;case"pullQuote":b="icon-pullquote";break;case"23rightVideo":b="icon-videoRight";break;case"23leftVideo":b="icon-videoLeft";break;case"body":b="icon-text";break;case"image":b="icon-img";break;case"code":b="icon-code";break;case"video":b="icon-video";break;case"Teaser Image":b="icon-projectTeaser";break;case"Lead Photo":b="icon-contentLead";break;case"Blog Teaser Image":b="icon-blogTeaser";break;case"Hero Parallax Image":b="icon-imgHero";break;case"Avatar BW":b="icon-profile";break;case"Avatar Color":b="icon-profile"}return b},this.getSpecsForBlockType=function(a){var b="";switch(a){case"Teaser Image":b="At Least 1158px x 760px";break;case"Lead Photo":b="At Least 1920px x 1260px";break;case"23right":b="At Least 1920px x 1260px";break;case"23left":b="At Least 1920px x 1260px";break;case"fullBleed":b="At Least 3360px x 1120px";break;case"image":b="At Least 1920px x 1260px";break;case"Blog Teaser Image":b="At Least 800px x 800px";break;case"Hero Parallax Image":b="At Least 3360 px WIDE, variable height";break;case"Avatar BW":b="At Least 600 px x 600px";break;case"Avatar Color":b="At Least 600 px x 600px"}return b},this.getInfoForBlockType=function(a){var b="";switch(a){case"Teaser Image":b="Appears in the All Projects grid";break;case"Lead Photo":b="Appears at the top of the project page";break;case"23right":b="Standard project image left with text right";break;case"23left":b="Standard project image right with text left";break;case"fullBleed":b="Full width compositional image break";break;case"image":b="Appears inline within the blog post";break;case"Blog Teaser Image":b="Appears in a circular crop on the blog page";break;case"Hero Parallax Image":b="Fills area above post with scroll effect";break;case"Avatar BW":b="Appears on US grid, profile page, & blog posts";break;case"Avatar Color":b="Appears on hover over black & white avatar on US page"}return b},this.getUrlForBlockType=function(a){var b="";switch(a){case"Teaser Image":b="/resize-workteaser/";break;case"Lead Photo":b="/resize-lead/";break;case"23right":b="/resize-contentimage/";break;case"23left":b="/resize-contentimage/";break;case"fullBleed":b="/resize-imagebreak/";break;case"image":b="/resize-fullsize/";break;case"Blog Teaser Image":b="/resize-blogteaser/";break;case"Hero Parallax Image":b="/resize-hero/";break;case"Avatar BW":b="/resize-avatar/";break;case"Avatar Color":b="/resize-avatar/"}return b},this.getAltTextBoolean=function(a){var b=!0;switch(a){case"Blog Teaser Image":b=!1;break;case"Hero Parallax Image":b=!1;break;case"Teaser Image":b=!1;break;case"Lead Photo":b=!1;break;case"Avatar BW":b=!1;break;case"Avatar Color":b=!1}return b}});